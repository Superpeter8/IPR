# ---------Initialize Simulation---------
clear
units           metal
dimension       3
boundary        p p p   #p indicates that the boundary (x,y,z) is periodic  s is shrink-wrapped
atom_style      atomic
atom_modify     map array

variable        dumpfile string $d
variable        finald string ${finaldump}
variable        Temp equal $T 
variable        RH equal $R
variable        seed equal $s
variable        vel_seed equal floor(random(0,100000,v_seed))
variable        anneal_seed equal floor(random(0,100000,v_seed))

# ---------Create dummy simulation box -----------------
lattice 	diamond 5.43 orient x 1 0 0 orient y 0 1 0 orient z 0 0 1
#newton		on
region		BOX block 0 2 0 2 0 2 units lattice
create_box	1 BOX

mass		1 28.0855
region		cSi block 0 2 0 2 0 2 units lattice
create_atoms 	1 region cSi
region          remove sphere 0.5 0.5 1 0.1 units lattice side in
delete_atoms    region remove
region          remove2 sphere 1.25 1.25 1.25 0.1 units lattice side in
delete_atoms    region remove2
region          remove3 sphere 1 1 1 0.1 units lattice side in
delete_atoms    region remove3

region          BlastSphere sphere 1 1 1 ${RH} units lattice side in



# ----------Define interatomic potential --------------
#pair_style      quip
#pair_coeff      * * ../../GAP_potential/GAP_glue_soap_round27p_changedSigmas_1.xml "Potential xml_label=GAP_2021_5_20_-420_22_4_59_655" 1 14

pair_style 	tersoff/mod/c/omp
pair_coeff 	* * Si.tersoff.modc Si

# --------- Delete any atoms within a 0.5 Angstrom cutoff radius -------
#delete_atoms	overlap 0.5 original added

# --------- Create the localized heating group -----------
group           mobileatoms region BlastSphere

# ----------Dump xyz file with atoms and bonds -----------
# Read with Ovito or jmol
dump            1 all atom 100 ${dumpfile}
#dump_modify     1 element Si H

# ------- Initialize conditions ----------
#set initial temperature of deposited a-Si to be 1600K, so that we avoid a large strain on the system
#velocity       mobileatoms create 300.0 ${vel_seed} mom yes rot yes dist gaussian  # mom and rot yes means net linear and angular momentum is zero
timestep        .0001 #1 fs time steps

# ------- Display conditions each 1000 step
thermo_style    custom step temp pe ke etotal
thermo          100


#Anneal the a-Si at 2000K for 4 ps
velocity        mobileatoms create ${Temp} ${vel_seed} mom yes rot yes dist gaussian
fix             anneal mobileatoms nvt temp ${Temp} ${Temp} 0.1
run             10000
unfix           anneal

#Reduce T to 0K very quickly
fix             cool mobileatoms nvt temp ${Temp} 1.0 0.1
run             3000
unfix           cool

# --------Run simulation -------------
#First perform potential energy minimization with a conjugate gradient method
#min_style       hftn
#minimize        1.0e-2 1.0e-3 100 1000

# --------- Dump xyz file with atoms of only the final state ------------
#write_dump      all atom ${finald} modify scale no
